<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="NotaCredito" pageWidth="595" pageHeight="842" columnWidth="534" leftMargin="42" rightMargin="19" topMargin="28" bottomMargin="28" uuid="d142408a-0f2e-4041-9fc9-7987df8c1dfb">
	<property name="ireport.zoom" value="1.5000000000000002"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="CBTE_ID" class="java.lang.Integer">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[select 1 as pag, ss.* FROM ( SELECT dc.id, nc.numero, nc.tipo, nc.fecha_nota_credito fecha, nc.importe,
 pro.nombre AS proveedor, pro.num_doc, pro.direccion, con.id as contribuyente
, dc.cantidad, dc.precio_unitario, p.nombre AS producto ,p.codigo, iva.iva
from nota_credito nc
JOIN detalle_nota_credito dc ON nc.id = dc.nota_credito
JOIN producto p ON dc.producto = p.id
JOIN iva ON p.iva = iva.id
JOIN cliente pro ON pro.id = nc.cliente
JOIN contribuyente con ON pro.contribuyente = con.id
WHERE nc.id IS NOT NULL
AND nc.id = $P{CBTE_ID}
ORDER BY dc.id
) ss
UNION
select 2 as pag, ss.* FROM ( SELECT dc.id, nc.numero, nc.tipo, nc.fecha_nota_credito fecha, nc.importe,
 pro.nombre AS proveedor, pro.num_doc, pro.direccion, con.id as contribuyente
, dc.cantidad, dc.precio_unitario, p.nombre AS producto ,p.codigo, iva.iva
from nota_credito nc
JOIN detalle_nota_credito dc ON nc.id = dc.nota_credito
JOIN producto p ON dc.producto = p.id
JOIN iva ON p.iva = iva.id
JOIN cliente pro ON pro.id = nc.cliente
JOIN contribuyente con ON pro.contribuyente = con.id
WHERE nc.id IS NOT NULL
AND nc.id = $P{CBTE_ID}
ORDER BY dc.id
) ss
ORDER BY pag, id]]>
	</queryString>
	<field name="pag" class="java.lang.Integer"/>
	<field name="id" class="java.lang.Integer"/>
	<field name="numero" class="java.math.BigDecimal"/>
	<field name="tipo" class="java.lang.String">
		<fieldDescription><![CDATA[1 factu_compra, 2 factu_venta, 3 remesa, 4 recibo, 5 movimiento caja, 6 devolucion (anulacion), 7 apertura caja, 8 mov. varios, 9 mov interno (MVI), 10 cheque terceros, 11 cheques propios]]></fieldDescription>
	</field>
	<field name="fecha" class="java.sql.Date"/>
	<field name="importe" class="java.math.BigDecimal"/>
	<field name="proveedor" class="java.lang.String"/>
	<field name="num_doc" class="java.math.BigDecimal"/>
	<field name="direccion" class="java.lang.String"/>
	<field name="contribuyente" class="java.lang.Integer"/>
	<field name="cantidad" class="java.lang.Integer"/>
	<field name="precio_unitario" class="java.math.BigDecimal"/>
	<field name="producto" class="java.lang.String"/>
	<field name="codigo" class="java.lang.String"/>
	<field name="iva" class="java.math.BigDecimal"/>
	<variable name="precioUnitario" class="java.math.BigDecimal">
		<variableExpression><![CDATA[$F{precio_unitario}.add(
new BigDecimal($F{precio_unitario}.doubleValue() * ($F{iva}.floatValue()/100))
).setScale(4, java.math.RoundingMode.HALF_EVEN)]]></variableExpression>
	</variable>
	<variable name="V_IMPORTE" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$V{precioUnitario}.multiply(BigDecimal.valueOf($F{cantidad}))]]></variableExpression>
		<initialValueExpression><![CDATA[BigDecimal.ZERO]]></initialValueExpression>
	</variable>
	<group name="paginacion" isStartNewPage="true">
		<groupExpression><![CDATA[$F{pag}]]></groupExpression>
	</group>
	<pageHeader>
		<band height="180" splitType="Stretch">
			<textField>
				<reportElement uuid="86b0598a-7a54-4489-9e09-816d828e5a9e" x="61" y="98" width="473" height="16"/>
				<textElement/>
				<textFieldExpression><![CDATA[$F{proveedor}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement uuid="52e86622-3d92-4913-8ee2-bfcc4de5568e" x="385" y="148" width="100" height="16"/>
				<textElement/>
				<textFieldExpression><![CDATA[$F{num_doc}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement uuid="5f2da3dc-110d-42a1-813f-4abee0cc5f2b" x="61" y="123" width="473" height="16"/>
				<textElement/>
				<textFieldExpression><![CDATA[$F{direccion}]]></textFieldExpression>
			</textField>
			<textField pattern="dd  MM    yyyy">
				<reportElement uuid="e1167d6d-a565-46c1-a13b-73ccb02483fe" x="380" y="37" width="107" height="20"/>
				<textElement verticalAlignment="Top">
					<font size="14" isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{fecha}]]></textFieldExpression>
			</textField>
			<line>
				<reportElement uuid="f2367992-1a59-4629-8ddf-09e46768e9f7" x="0" y="0" width="20" height="1"/>
			</line>
			<line>
				<reportElement uuid="c93eb1f8-4e24-4c35-8656-c3bd353e4a09" x="0" y="0" width="1" height="20"/>
			</line>
			<staticText>
				<reportElement uuid="5a1374d7-fa51-47db-9181-15a74c31b589" x="130" y="143" width="10" height="10">
					<printWhenExpression><![CDATA[$F{contribuyente}.intValue() == 2]]></printWhenExpression>
				</reportElement>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="7" isBold="true"/>
				</textElement>
				<text><![CDATA[X]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="777e4abb-d99f-454e-8560-296e2b32b145" x="130" y="155" width="10" height="10">
					<printWhenExpression><![CDATA[$F{contribuyente}.intValue() == 1]]></printWhenExpression>
				</reportElement>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="7" isBold="true"/>
				</textElement>
				<text><![CDATA[X]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="9883a3e2-ea2f-4a61-a546-23e01ac97c5a" x="276" y="143" width="10" height="10">
					<printWhenExpression><![CDATA[$F{contribuyente}.intValue() == 5]]></printWhenExpression>
				</reportElement>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="7" isBold="true"/>
				</textElement>
				<text><![CDATA[X]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="81a64cb6-1569-4e6b-b456-fbdc8402c786" x="276" y="155" width="10" height="10">
					<printWhenExpression><![CDATA[$F{contribuyente}.intValue() == 3]]></printWhenExpression>
				</reportElement>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="7" isBold="true"/>
				</textElement>
				<text><![CDATA[X]]></text>
			</staticText>
		</band>
	</pageHeader>
	<columnHeader>
		<band height="17" splitType="Stretch"/>
	</columnHeader>
	<detail>
		<band height="16">
			<textField>
				<reportElement uuid="e3e2acac-fc43-49e8-940c-f23fe19a3948" x="1" y="0" width="35" height="12"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="9"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{cantidad}]]></textFieldExpression>
			</textField>
			<textField pattern="¤ #,##0.00">
				<reportElement uuid="1b9325c8-f4cf-4ab1-9cac-40d3687ea7bd" x="455" y="0" width="61" height="12"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="9"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{precioUnitario}.doubleValue() * $F{cantidad}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true">
				<reportElement uuid="015846d8-a709-4973-aea9-dc397939ab8b" x="137" y="0" width="249" height="12"/>
				<textElement verticalAlignment="Middle">
					<font size="9"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{producto}.concat("(").concat($F{iva}.toString()).concat(")")]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement uuid="a161dcc8-0d04-492f-9b18-82c98f60e1a2" x="55" y="0" width="82" height="12"/>
				<textElement verticalAlignment="Middle">
					<font size="9"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{codigo}]]></textFieldExpression>
			</textField>
			<textField pattern="¤ #,##0.0000">
				<reportElement uuid="f6d968e7-dab6-4b31-a1ea-51064ed1d16f" x="386" y="0" width="61" height="12"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="9"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{precioUnitario}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<columnFooter>
		<band height="42">
			<line>
				<reportElement uuid="14b55c70-b295-4f2f-91b3-71052ac7304e" x="0" y="41" width="10" height="1"/>
				<graphicElement>
					<pen lineWidth="0.5"/>
				</graphicElement>
			</line>
			<line>
				<reportElement uuid="99102209-3691-4527-a99f-8b178c16243d" x="0" y="31" width="1" height="11"/>
				<graphicElement>
					<pen lineWidth="0.5"/>
				</graphicElement>
			</line>
			<textField pattern="¤ #,##0.00">
				<reportElement uuid="ec9c36ec-8c86-4d1d-83f7-f000baba1705" x="455" y="0" width="61" height="14"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{importe}]]></textFieldExpression>
			</textField>
		</band>
	</columnFooter>
	<pageFooter>
		<band height="410"/>
	</pageFooter>
</jasperReport>
